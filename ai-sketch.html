<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI스케치 정교화 - Vention</title>
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <div class="app-container">
      <!-- 사이드바 -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <img src="/assets/images/vention_remove.png" alt="Vention" class="logo-image" />
          <h1 class="logo">Vention</h1>
          <p class="tagline">발명 생산성 웹앱</p>
        </div>
        <nav class="sidebar-nav">
          <a href="index.html" class="nav-item">
            <span class="nav-icon">🏠</span>
            <span>홈</span>
          </a>
          
          <!-- 학생용 탭 -->
          <div id="studentNavItems">
            <a href="patent-chatbot.html" class="nav-item">
              <span class="nav-icon">📋</span>
              <span>AI 변리사</span>
            </a>
            <a href="idea-chatbot.html" class="nav-item">
              <span class="nav-icon">💡</span>
              <span>아이디어 챗봇</span>
            </a>
            <a href="ai-sketch.html" class="nav-item active">
              <span class="nav-icon">✏️</span>
              <span>AI스케치 정교화</span>
            </a>
            <a href="3d-modeling.html" class="nav-item">
              <span class="nav-icon">🎨</span>
              <span>3D 모델링</span>
            </a>
            <a href="3d-view.html" class="nav-item">
              <span class="nav-icon">👁️</span>
              <span>3D 뷰</span>
            </a>
          </div>
        </nav>
        
        <!-- 교사 모니터링 및 로그아웃 (하단) -->
        <div class="sidebar-footer">
          <a href="teacherMonitor.html" class="nav-item" id="teacherMonitorLink" style="display: none;">
            <span class="nav-icon">👨‍🏫</span>
            <span>교사 모니터링</span>
          </a>
          <button class="nav-item" id="sidebarLogoutBtn" style="display: none; width: 100%; text-align: left; background: none; border: none; cursor: pointer;">
            <span class="nav-icon">🚪</span>
            <span>로그아웃</span>
          </button>
        </div>
      </aside>

      <!-- 메인 컨텐츠 -->
      <main class="main-content">
        <div class="page-header">
          <h1>AI스케치 정교화</h1>
          <p class="subtitle">스케치를 업로드하고 AI로 정교화해보세요</p>
        </div>

        <div class="content-section">
          <div class="sketch-container">
            <!-- 인증 설정 -->
            <div class="api-key-card">
              <div class="api-key-header">
                <h3 class="panel-title">🔑 인증 설정</h3>
                <p class="api-key-description">다음 중 하나의 방법으로 인증해주세요.</p>
              </div>
              
              <!-- 인증 방법 선택 버튼 -->
              <div class="auth-buttons">
                <button id="apiKeyAuthBtn" class="auth-toggle-btn active">
                  Gemini API 키 입력
                </button>
                <button id="passwordAuthBtn" class="auth-toggle-btn">
                  비밀번호 입력
                </button>
              </div>
              
              <div id="apiKeyMessage" class="api-key-message" style="display: none;"></div>
              
              <!-- 방법 1: API 키 입력 -->
              <div id="apiKeyAuthPanel" class="auth-panel active">
                <div class="api-key-input-group">
                  <input
                    type="password"
                    id="apiKeyInput"
                    placeholder="AIza..."
                    class="api-key-input"
                  />
                  <button id="saveApiKeyBtn" class="btn btn-secondary">인증</button>
                </div>
                <p class="auth-hint">
                  <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--accent-color);">API 키 발급받기</a>
                </p>
              </div>
              
              <!-- 방법 2: 비밀번호 입력 -->
              <div id="passwordAuthPanel" class="auth-panel" style="display: none;">
                <div class="api-key-input-group">
                  <input
                    type="password"
                    id="passwordInput"
                    placeholder="비밀번호를 입력하세요"
                    class="api-key-input"
                  />
                  <button id="savePasswordBtn" class="btn btn-secondary">인증</button>
                </div>
                <p class="auth-hint">비밀번호를 입력하면 서버 API 키를 사용합니다.</p>
              </div>
              
              <p class="api-key-hint" style="margin-top: 16px;">API 키 또는 비밀번호 중 하나만 입력하면 사용할 수 있습니다.</p>
            </div>

            <!-- 정보 카드 -->
            <div class="info-card">
              <div class="info-card-title">
                <span>🎨</span>
                <span>이렇게 도와드려요!</span>
              </div>
              <p class="info-card-text">
                그림 실력이 부족해도 괜찮습니다. 대략적인 형태만 그려서 업로드하면, AI가 선을 다듬고 
                배경을 제거하여 <strong>전문적인 제품 디자인</strong>처럼 만들어드립니다.
              </p>
            </div>

            <!-- 업로드 섹션 -->
            <div class="upload-section">
              <!-- 1. 스케치 업로드 -->
              <div class="upload-panel">
                <h3 class="panel-title">1. 내 스케치 올리기</h3>
                <div 
                  class="upload-zone" 
                  id="uploadZone"
                >
                  <img id="originalImage" src="" alt="Original Sketch" class="result-image" style="display: none;" />
                  <div id="uploadPlaceholder" class="upload-placeholder">
                    <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <div class="upload-title">이미지를 드래그하거나 클릭하세요</div>
                    <div class="upload-subtitle">JPG, PNG, WebP 형식 지원</div>
                  </div>
                  <input type="file" id="fileInput" accept="image/*" class="file-input" />
                </div>
              </div>

              <!-- 2. 디자인 다듬기 -->
              <div class="upload-panel">
                <h3 class="panel-title">2. 디자인 다듬기</h3>
                
                <!-- 모드 선택 -->
                <div class="mode-selection" style="margin-bottom: 16px;">
                  <label class="mode-option">
                    <input type="radio" name="generationMode" value="sketch" checked />
                    <span>스케치</span>
                  </label>
                  <label class="mode-option">
                    <input type="radio" name="generationMode" value="rendering" />
                    <span>렌더링</span>
                  </label>
                </div>
                
                <textarea
                  id="promptInput"
                  placeholder="어떤 제품인지 설명해주세요. (예: 손잡이가 인체공학적인 칫솔, 투명한 재질의 물병)"
                  class="sketch-textarea"
                  rows="4"
                ></textarea>
                <button
                  id="enhanceBtn"
                  class="btn btn-primary btn-full"
                  disabled
                >
                  스케치 정교화하기
                </button>
              </div>
            </div>

            <!-- 3. 결과 표시 -->
            <div class="upload-panel">
              <h3 class="panel-title">3. AI 정교화 결과</h3>
              <div class="generation-placeholder" id="resultContainer">
                <p>AI가 다듬은 깔끔한 디자인이 여기에 표시됩니다.</p>
              </div>
              <div id="errorMessage" class="error-message" style="display: none;"></div>
              
              <!-- 다운로드 및 렌더링 버튼 -->
              <div id="resultActions" style="display: none; margin-top: 16px;">
                <button
                  id="downloadBtn"
                  class="btn btn-secondary"
                  style="flex: 1; min-width: 120px;"
                >
                  📥 이미지 다운로드
                </button>
                <button
                  id="renderBtn"
                  class="btn btn-primary"
                  style="flex: 1; min-width: 120px;"
                >
                  🎨 렌더링하기
                </button>
              </div>
              
              <button
                id="goToModelingBtn"
                class="btn btn-primary btn-full"
                style="display: none; margin-top: 16px; background: var(--accent-color);"
              >
                3D 모델링 하러 가기 →
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script type="module" src="/src/ai-sketch.js"></script>
    <script type="module">
      import { initAuth } from '/src/auth.js';
      initAuth();
    </script>
  </body>
</html>

